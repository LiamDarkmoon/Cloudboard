---
async function login(event: SubmitEvent) {
  event.preventDefault();

  try {
    const body = new URLSearchParams();
    body.append("email", document.getElementById("email").value);
    body.append("password", document.getElementById("password").value);

    const res = await fetch("https://cloudapi-chi.vercel.app/auth/login", {
      method: "POST",
      headers: {
        "Content-Type": "application/x-www-form-urlencoded"
      },
      body: body.toString()
    });

    if (!res.ok) {
      const errorText = await res.text();
      console.error("Error:", res.status, errorText);
      return;
    }

    const data = await res.json();
    console.log("Response data:", data);

    const token = data.user_token || data.token;
    if (token) {
      sessionStorage.setItem("userToken", token);
      console.log("Token guardado correctamente");
    } else {
      console.warn("No se recibió token en la respuesta");
    }

  } catch (err) {
    console.error("Error en login:", err);
  }
}
---

<form method="post" action="https://cloudapi-chi.vercel.app/auth/login">
  <div class="form-group">
    <label for="email">Email</label>
    <input type="email" name="username" id="username" placeholder="youremail@domain.com" autofocus required/>
  </div>
  <div class="form-group">
    <label for="password">Password</label>
    <input type="password" name="password" id="password" placeholder="Enter your password" required/>
  </div>
  <button class="cta_bttn" type="submit">Submit</button>
  <a href="/register">
    ¿No tienes cuenta? ¡registrate aqui!
  </a>
</form>

<style>
  form {
    padding-top: 32px;
    height: 100%;
    width: 33%;
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  form a {
    text-align: center;
  }

  .form-group {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  label {
    font-weight: bold;
  }

  input {
    padding: 8px;
    border: 1px solid var(--main-divider-color);
    border-radius: 4px;
  }

  input:focus {
    outline: 2px solid var(--main-accent-color-active);  
  }

</style>